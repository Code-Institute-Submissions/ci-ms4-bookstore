{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid">
      <div class="jumbotron jumbotron-fluid" id="home-jumbotron-bg">
          <h1 class="display-4">Bibliomania, the one-stop shop for fiction you love!</h1>
          <p class="lead">"The saddest aspect of life right now is that science fiction gathers knowledge faster than society gathers wisdom." - Isaac Asimov</p>
          <hr class="my-4">
          <a class="btn btn-outline-light btn-lg" href="{% url 'products' %}" role="button">See our full list of books for sale!</a>
        </div>
</div>

{% if request.user.is_superuser %}
<hr>
<div class="container-fluid">  
  <div class="row text-center">
    <h2>News administration:</h2>
    <p class="text-center">Welcome back, {{request.user}}! Here is a quick summary on how to administer the frontpage news on the page.</p>
  </div>
  <br>  
</div>
<hr>
<div class="container-fluid">
<div class="row">
  <div class="col-md-4 col-sm-12">
    <hr>
    <h4>How do I add posts? <a href="#newsPostModal" data-toggle="modal" data-target="#newsPostModal"><i class="fas fa-pen"></i></a></h4> 
    <p>You can add news to the frontpage from here or from the staff dashboard. Simply click the 
      <a href="#newsPostModal" data-toggle="modal" data-target="#newsPostModal"><i class="fas fa-pen"></i></a> and enter any news you want added.</p>
    <hr>
  </div>

  <div class="col-md-4 col-sm-12">
    <hr>
    <h4>How do I edit posts? <i class="fas fa-edit"></i></h4>
    <p>You can edit already posts either from the front page or the archives. You just need to look for the <i class="fas fa-edit"></i> symbol in the news list and click it. 
      Note: You will be signed as the news-items author and the time-stamp will update to the time of your post, meaning the item will be posted to the top of the news.</p>
    <hr>
  </div>

  <div class="col-md-4 col-sm-12">
    <hr>
    <h4>How do I delete posts? <i class="fas fa-trash-alt"></i></h4>
    <p>Like with editing, find the header in the archives or in the list-view. Click the <i class="fas fa-trash-alt"></i> 
      symbol and confirm you're sure you want to delete the item.</p>
    <hr>
  </div>
</div>
</div>

<div class="modal fade" id="newsPostModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="newsPostModalLabel">Add News:</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form class="form" action="{% url 'add_post' %}" method="POST">
        <div class="form-group">
          <div class="modal-body">
              {% csrf_token %}
              {{ form }}                   
              <p>Your display-name and the time of posting will be automatically added when you press save.</p>
          </div>
          <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-secondary" value="Save">
      </div>
    </div>
    </form> 
  </div>
    
  </div>
</div>

{% endif %}

<div class="accordion" id="accordionNews">      
   {% for item in news %}
      <div class="card">
        <div class="card-header" id="heading-{{item.pk}}">
          <h2 class="mb-0">                     
            <button class="btn" type="button" data-toggle="collapse" role="button" data-target="#article-{{item.pk}}" aria-expanded="false " aria-controls="article-{{item.pk}}">
                {{item.title}}  ( {{item.time}} )
            </button>
          </h2>            
            <!-- Adding administration GUI for the news post, if the user is an authenticated admin. -->
            {% if request.user.is_superuser %}
            <div id="admin-gui" class="d-flex align-items-right">
            <!-- Delete item link. -->
            <a href="{% url 'delete_post' news_id=item.pk %}"><i class="fas fa-trash-alt"></i></a>
            
            <!-- Creates a modal for editing posts already submitted. -->
            <button type="button" class="btn btn-link" data-toggle="modal" data-target="#edit-post-{{item.pk}}">
              <i class="fas fa-edit"></i>
            </button>
            <!-- Edit post modal. -->
            <div class="modal fade" id="edit-post-{{item.pk}}" tabindex="-1" role="dialog" aria-labelledby="editModalTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="editModalTitle">Edit news: </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <form action="{% url 'edit_post' news_id=item.pk %}" method="POST">
                  <div class="form-group">
                    <div class="modal-body">                      
                          {% csrf_token %}
                          {{form}}                      
                    </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>                        
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
            {% endif %}
          </div>
          <div id="article-{{item.pk}}" class="collapse" aria-labelledby="heading-{{item.pk}}" data-parent="#accordionNews">
            <div class="card-body">
              {{item.post}}
              <br>
              <br>
              <h6>Author: {{item.author}}</h6>
              <br>
              <h6>Date: {{item.time}}</h6>
            </div>        
          </div>
        </div>  
    {% endfor%}         
</div>   
{% endblock %}